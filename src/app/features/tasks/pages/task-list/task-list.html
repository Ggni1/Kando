<div class="task-list-layout">
    <app-navbar></app-navbar>

    <main class="task-container">
        <header class="task-header">
            <div class="header-content">
                <h1>Tasks</h1>
                @if (isAdmin()) {
                    <a class="btn-create" routerLink="/tasks/create">+ New Task</a>
                }
            </div>
            <input 
                class="search-bar" 
                type="text"
                placeholder="Search task..."
                [ngModel]="searchFilter()"
                (ngModelChange)="searchFilter.set($event)" />
        </header>

        @if (errorMessage()) {
            <div class="error-notification">{{ errorMessage() }}</div>
        }

        @if (loading()) {
            <div class="loading">Loading tasks...</div>
        } @else {
            @if (filteredTasks().length === 0) {
                <div class="no-tasks">
                    <p>No tasks available</p>
                </div>
            } @else {
                <div class="tasks-grid">
                    @for (task of filteredTasks(); track task.id) {
                        <div class="task-item">
                            <div class="task-header-item">
                                <h3>{{ task.title }}</h3>
                                @if (task.tag) {
                                    <span class="tag">{{ task.tag }}</span>
                                }
                            </div>
                            <p class="task-username">Assigned to: {{ getUserUsername(task.user_id) }}</p>
                            <div class="task-actions">
                                <a [routerLink]="['/tasks', task.id]" class="btn-view">View</a>
                                @if (!isGuest() && isAdmin()) {
                                    <a [routerLink]="['/tasks', task.id, 'edit']" class="btn-edit">Edit</a>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
        }
    </main>

    <app-footer></app-footer>
</div>
